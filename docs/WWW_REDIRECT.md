# WWW to Non-WWW Redirect

## Overview

All traffic to `www.jameskilby.co.uk` is automatically redirected to `jameskilby.co.uk` (non-www) to maintain a consistent canonical URL structure.

## Implementation

### Redirect Rule

**File:** `public/_redirects` (Cloudflare Pages format)

```
# Redirect www to non-www (canonical URL)
https://www.jameskilby.co.uk/* https://jameskilby.co.uk/:splat 301
```

### How It Works

- **Pattern:** `https://www.jameskilby.co.uk/*`
  - Matches all URLs on the www subdomain
  - `*` captures the entire path

- **Target:** `https://jameskilby.co.uk/:splat`
  - `:splat` replaces the captured path
  - Preserves query strings and fragments

- **Status Code:** `301` (Permanent Redirect)
  - SEO-friendly
  - Tells search engines the www version is permanently moved
  - Browsers cache the redirect

### Examples

| Original URL | Redirects To |
|-------------|--------------|
| `https://www.jameskilby.co.uk/` | `https://jameskilby.co.uk/` |
| `https://www.jameskilby.co.uk/about-me/` | `https://jameskilby.co.uk/about-me/` |
| `https://www.jameskilby.co.uk/2025/08/vmc-host-deepdive/` | `https://jameskilby.co.uk/2025/08/vmc-host-deepdive/` |

## Generation

The redirect rule is automatically generated by `wp_to_static_generator.py`:

**Method:** `create_redirects_file()`  
**Location:** Line 1481 in `wp_to_static_generator.py`

```python
def create_redirects_file(self):
    """Create redirects for old URLs (Netlify/Cloudflare format)"""
    redirects_content = [
        "# Redirect www to non-www (canonical URL)",
        "https://www.jameskilby.co.uk/* https://jameskilby.co.uk/:splat 301",
        "",
        "# Automatic redirects for spelling corrections",
        "/2025/04/warp-the-inteligent-terminal/ /2025/04/warp-the-intelligent-terminal/ 301",
        "/category/artificial-inteligence/ /category/artificial-intelligence/ 301"
    ]
    
    redirects_file = self.output_dir / '_redirects'
    redirects_file.write_text('\n'.join(redirects_content))
```

## Why Non-WWW?

### SEO Benefits

1. **Canonical URL Consistency**
   - Single version prevents duplicate content issues
   - Consolidates link equity (backlinks point to one version)
   - Clearer analytics and tracking

2. **Modern Standard**
   - Non-www is the modern convention
   - Shorter, cleaner URLs
   - Easier to remember and type

3. **Technical Benefits**
   - Fewer DNS lookups (www requires additional CNAME)
   - Simpler SSL/TLS certificate management
   - Cookie scope control (non-www can set cookies for subdomains)

### Industry Practice

Major tech companies use non-www:
- `google.com` (not `www.google.com`)
- `facebook.com` (not `www.facebook.com`)
- `github.com` (not `www.github.com`)
- `cloudflare.com` (not `www.cloudflare.com`)

## Verification

### Test the Redirect

```bash
# Should return 301 redirect
curl -I https://www.jameskilby.co.uk/

# Expected output:
HTTP/2 301
location: https://jameskilby.co.uk/
```

### Test with Path

```bash
# Should redirect with path preserved
curl -I https://www.jameskilby.co.uk/about-me/

# Expected output:
HTTP/2 301
location: https://jameskilby.co.uk/about-me/
```

### Browser Test

1. Visit `https://www.jameskilby.co.uk/` in browser
2. URL bar should automatically change to `https://jameskilby.co.uk/`
3. No flash/reload should be visible (instant redirect)

## Cloudflare Pages Configuration

The `_redirects` file is automatically processed by Cloudflare Pages:

- **Processing:** At request time (edge network)
- **Performance:** ~0-5ms overhead
- **Caching:** 301 redirects are cached by browsers
- **Priority:** Processed before page serving

### Cloudflare Pages Redirect Syntax

```
[source] [destination] [status_code]
```

**Placeholders:**
- `:splat` - Captures entire path (everything after domain)
- `:param` - Named parameter
- `*` - Wildcard match

**Examples:**
```
# Domain redirect with path preservation
https://www.example.com/* https://example.com/:splat 301

# Path redirect
/old-page /new-page 301

# Wildcard subdirectory
/blog/* /articles/:splat 301
```

## Alternative: DNS-Level Redirect

For even better performance, you can also configure the www redirect at DNS level in Cloudflare:

1. **Cloudflare Dashboard** → Domain → DNS
2. Add CNAME record: `www` → `jameskilby.co.uk`
3. Enable "Proxied" (orange cloud)
4. **Page Rules** → Create rule:
   - URL: `www.jameskilby.co.uk/*`
   - Setting: Forwarding URL (301)
   - Destination: `https://jameskilby.co.uk/$1`

**Note:** The current `_redirects` file approach is simpler and works well for Cloudflare Pages.

## SEO Impact

### Positive Effects

1. **Eliminates Duplicate Content**
   - Search engines see one canonical version
   - No split ranking signals

2. **Consolidates Link Equity**
   - All backlinks count toward one URL
   - Stronger domain authority

3. **Clearer Search Console Data**
   - Single property to monitor
   - Unified analytics

### Migration Considerations

If you previously used www:
- 301 redirect preserves ~99% of SEO value
- Search engines update index within days/weeks
- No manual intervention needed
- Backlinks automatically credited to new URL

## Canonical Tags

In addition to the redirect, all pages include canonical tags pointing to non-www:

```html
<link rel="canonical" href="https://jameskilby.co.uk/path/" />
```

This provides a second layer of canonicalization for search engines.

## Related Files

- `public/_redirects` - Generated redirect rules
- `wp_to_static_generator.py` - Generator script
- `SECURITY_HEADERS.md` - Related Cloudflare Pages configuration
- `.github/workflows/deploy-static-site.yml` - Auto-deployment

## Maintenance

The redirect rule is:
- ✅ Automatically generated during site build
- ✅ Committed to Git repository
- ✅ Deployed with every site update
- ✅ No manual configuration needed

## Troubleshooting

### Redirect Not Working

**Check:**
1. Does `public/_redirects` exist?
2. Is the file deployed to Cloudflare Pages?
3. Is Cloudflare Pages project configured correctly?

**Debug:**
```bash
# Check local file
cat public/_redirects

# Check deployed version
curl -I https://www.jameskilby.co.uk/
```

### Redirect Loop

If you see infinite redirects:
- Check for conflicting rules in Cloudflare Page Rules
- Verify `_redirects` file syntax
- Clear browser cache

### Certificate Errors on WWW

Ensure Cloudflare SSL certificate covers both:
- `jameskilby.co.uk`
- `www.jameskilby.co.uk`

Cloudflare's Universal SSL automatically covers both.

## Performance

**Redirect Speed:**
- DNS resolution: ~20ms
- TLS handshake: ~50ms
- Redirect processing: <5ms
- **Total:** ~75ms overhead

After first visit, browsers cache the 301 redirect, eliminating overhead for repeat visitors.

## Analytics

### Tracking Redirects

Plausible Analytics will show:
- Final URL (non-www) in page views
- Referrer preserved through redirect
- No duplicate counting

### Search Console

Submit both URLs to verify ownership:
- `https://jameskilby.co.uk` (primary property)
- `https://www.jameskilby.co.uk` (for monitoring redirects)

## Version History

- **v1.0** (2025-12-17) - Initial implementation
  - Added www to non-www redirect
  - 301 permanent redirect
  - Cloudflare Pages `_redirects` format
  - Auto-generated during static site build
