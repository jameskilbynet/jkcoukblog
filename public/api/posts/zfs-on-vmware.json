{
  "slug": "zfs-on-vmware",
  "title": "How to Run ZFS on VMware vSphere: Setup Guide and Best Practices",
  "description": "ZFS,VMware,Best Practices for seamless integration and performance. Learn how to optimize your setup for maximum efficiency and reliability.",
  "date": "2024-12-18T17:47:57Z",
  "modified": "2026-02-09T22:16:17Z",
  "author": "James Kilby",
  "url": "https://jameskilby.co.uk/2024/12/zfs-on-vmware/",
  "markdown_url": "/markdown/posts/zfs-on-vmware.md",
  "api_url": "/api/posts/zfs-on-vmware.json",
  "categories": [
    "TrueNAS Scale",
    "VMware",
    "vSAN",
    "vSphere",
    "Homelab",
    "Hosting",
    "Networking",
    "Storage",
    "Personal",
    "vExpert",
    "Nutanix"
  ],
  "tags": [
    null,
    null,
    null,
    null,
    null
  ],
  "image": "https://jameskilby.co.uk/wp-content/uploads/2024/12/IMG_20140330_210511-1024x845.jpeg",
  "content": "![](https://jameskilby.co.uk/wp-content/uploads/2024/12/ZFS.jpg)\n\n[TrueNAS Scale](https://jameskilby.co.uk/category/truenas-scale/) | [VMware](https://jameskilby.co.uk/category/vmware/) | [vSAN](https://jameskilby.co.uk/category/vmware/vsan-vmware/) | [vSphere](https://jameskilby.co.uk/category/vsphere/)\n\n# How to Run ZFS on VMware vSphere: Setup Guide and Best Practices\n\nBy[James](https://jameskilby.co.uk) December 18, 2024February 9, 2026 ‚Ä¢ üìñ3 min read(544 words)\n\nüìÖ **Published:** December 18, 2024‚Ä¢ **Updated:** February 09, 2026\n\n## Table of Contents\n\n## Introduction\n\nI have run a number of systems using ZFS since the earliest days of my homelab using Nexenta, all the way back in 2010. The image below command is my lab at the time with an IBM head unit that I think had 18GB of RAM 6x450GB SAS drives and this was then connected to the Dell PowerVault SCSI Array above it with 14x146GB 10K SAS drives‚Ä¶.\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/IMG_20140330_210511-1024x845.jpeg)Original Nexenta Setup\n\nThe number one rule is to ALWAYS give ZFS access to the underlying raw storage. You don‚Äôt want a raid controller or anything else interfering with the IO path. This is similar to how vSAN works with VMware.\n\nBut rules are meant to be broken right‚Ä¶.. \n\nI have virtualized a few copies of TrueNAS Scale and Core using ZFS on top of VMware. In these particular instances I specifically DON‚ÄôT want to pass through the storage HBA. Why would I do this? Mainly of two reasons. This allows me to test upgrades of my physical TrueNAS setup with an easy rollback if needed by not passing the drives or controllers in I can clone and snapshot the VMs‚Äôs just as if it was any other and move it around my lab infrastructure.\n\n## Copy on Write\n\nZFS is a ‚ÄúCopy on Write‚Äù file system which means that it never overwrites existing blocks of storage. It always places writes into new blocks. This is unfriendly with ‚Äúthin provisioning‚Äù something I am a huge fan of. This means that over time even a tiny database writing one megabyte file over and over again will slowly clog the entire file system.\n\nSo if you‚Äôre going to break the rules. The way I see it is you might as well do it properly\n\nThe first requirement is that the VM‚Äôs be provisioned with thin disks in vSphere. If is not thin then unmap won‚Äôt work. This is important in case you are thin at the underlay storage level.\n\n## Disk IDs\n\nYou also need to do is to to ensure that TrueNAS can see unique disk IDs. To do this shut down the VM‚Äôs and add the following parameter to the VMware VM‚Äôs configuration\n    \n    \n     disk.EnableUUID=TRUE\n\nüìã Copy\n\nOnce this is done when you power the VM‚Äôs on you should be able to see unique serials of each disk similar to this screenshot. Prior to this change, the serial section is blank.\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/Disk-Serials-1024x125.png)\n\n## Trim\n\nOnce the disks are seen as unique it is possible to enable trim. To confirm that trim is working execute the below command. ( I have no idea why this is a blocker but it is)\n    \n    \n    Sudo pool trim Pool-1\n\nüìã Copy\n\nI decided to manually enable it by executing the command command in the shell. (my Pool is called Pool-1)\n\nTo confirm that To confirm that trim is working execute the below command command is working execute the below command command\n    \n    \n    sudo zpool status Pool-1\n\nüìã Copy\n\nIf everything is working you will see trimming running next to the pool.\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/trimming-1-1024x452.png)\n\nA further validation that this is working is to review the VMs‚Äôs storage used, see the before and after of this VM‚Äôs storage\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/vm-Before-2.png) ![](https://jameskilby.co.uk/wp-content/uploads/2024/12/vm-After.png)\n\nAdditional confirmation can be seen by reviewing the underlying (vSAN consumption in this case). Before and after listed below command\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/vSAN-Before.png) ![](https://jameskilby.co.uk/wp-content/uploads/2024/12/vSAN-After-1.png)\n\n## üìö Related Posts\n\n  * [Can you really squeeze 96TB in 1U ?](https://jameskilby.co.uk/2024/09/can-you-really-squeeze-96tb-in-1u/)\n  * [TrueNAS Scale Useful Commands](https://jameskilby.co.uk/2023/11/truenas-scale-useful-commands/)\n\n## Similar Posts\n\n  * [ ![Starlink](https://jameskilby.co.uk/wp-content/uploads/2022/10/spacexs-starlink-to-supply-free-satellite-internet-to-famili_u44u.1920-768x432.jpg) ](https://jameskilby.co.uk/2022/10/starlink/)\n\n[Homelab](https://jameskilby.co.uk/category/homelab/) | [Hosting](https://jameskilby.co.uk/category/hosting/)\n\n### [Starlink](https://jameskilby.co.uk/2022/10/starlink/)\n\nBy[James](https://jameskilby.co.uk) October 11, 2022October 1, 2025\n\nSince moving to Dorset last year internet connectivity has been the bane of my existence. Currently, I have an ADSL connection provided by my old employer Zen and a 5G connection provided by Three. These are both plumbed into my WatchGuard Firewall with multi-wan configured. Most of the time the usability is ok but there‚Ä¶\n\n  * [ ![100Gb/s in my Homelab](https://jameskilby.co.uk/wp-content/uploads/2023/04/2157_hi_res-768x346.png) ](https://jameskilby.co.uk/2022/12/100gb-s-in-my-homelab-sort-of/)\n\n[Homelab](https://jameskilby.co.uk/category/homelab/) | [Networking](https://jameskilby.co.uk/category/networking/) | [Storage](https://jameskilby.co.uk/category/storage/) | [VMware](https://jameskilby.co.uk/category/vmware/)\n\n### [100Gb/s in my Homelab](https://jameskilby.co.uk/2022/12/100gb-s-in-my-homelab-sort-of/)\n\nBy[James](https://jameskilby.co.uk) December 19, 2022November 11, 2023\n\nFor a while, I‚Äôve been looking to update the networking at the core of my homelab. I have had some great results with the current setup utilising a number of DAC‚Äôs but there were a couple of things that were annoying me. Then MikroTik dropped the CRS504-4XQ-IN and if the price wasn‚Äôt horrendous then that‚Ä¶\n\n  * [ ![Can you really squeeze 96TB in 1U ?](https://jameskilby.co.uk/wp-content/uploads/2024/09/QuantaGrid-SD1Q-1ULH-Front-Three-Quarter.png) ](https://jameskilby.co.uk/2024/09/can-you-really-squeeze-96tb-in-1u/)\n\n[Homelab](https://jameskilby.co.uk/category/homelab/) | [Storage](https://jameskilby.co.uk/category/storage/) | [TrueNAS Scale](https://jameskilby.co.uk/category/truenas-scale/)\n\n### [Can you really squeeze 96TB in 1U ?](https://jameskilby.co.uk/2024/09/can-you-really-squeeze-96tb-in-1u/)\n\nBy[James](https://jameskilby.co.uk) September 12, 2024January 28, 2026\n\nYes, that‚Äôs a clickbait title. But technically it‚Äôs possible if I dropped all drive redundancy‚Ä¶ I recently saw an advert for a server that was just too good to be true. It promised to bring a huge amount of storage and future options in a quite hard-to-believe 1U. The price it was on offer for‚Ä¶\n\n  * [ ![VMware Certified Master Specialist HCI 2020](https://jameskilby.co.uk/wp-content/uploads/2020/09/vmware_SP_HCI20.png) ](https://jameskilby.co.uk/2020/09/vmware-certified-master-specialist-hci-2020/)\n\n[Personal](https://jameskilby.co.uk/category/personal/) | [VMware](https://jameskilby.co.uk/category/vmware/)\n\n### [VMware Certified Master Specialist HCI 2020](https://jameskilby.co.uk/2020/09/vmware-certified-master-specialist-hci-2020/)\n\nBy[James](https://jameskilby.co.uk) September 13, 2020November 11, 2023\n\nI recently sat (and passed the VMware HCI Master Specialist exam (5V0-21.20). I won‚Äôt go into any details of the contents but I will comment that I felt the questions were fair and that there wasn‚Äôt anything in it to trip you up. The required knowledge was certainly wider than the vSAN specialist exam. This‚Ä¶\n\n  * [ ![Intel Optane NVMe Homelab](https://jameskilby.co.uk/wp-content/uploads/2023/04/intel_optane_ssd_900p_series_aic_-_right_angle_575px.png) ](https://jameskilby.co.uk/2023/04/intel-optane/)\n\n[Homelab](https://jameskilby.co.uk/category/homelab/) | [Storage](https://jameskilby.co.uk/category/storage/) | [vExpert](https://jameskilby.co.uk/category/vexpert/)\n\n### [Intel Optane NVMe Homelab](https://jameskilby.co.uk/2023/04/intel-optane/)\n\nBy[James](https://jameskilby.co.uk) April 17, 2023October 1, 2025\n\nI have been a VMware vExpert for many years and it has brought me many many benefits over the years. I don‚Äôt think it‚Äôs an understatement to say I probably wouldn‚Äôt have my current role within VMware without it. One of the best benefits has been access to a huge amount of licences for VMware‚Ä¶\n\n  * [ ![New Nodes](https://jameskilby.co.uk/wp-content/uploads/2024/07/IMG_6629-768x149.jpeg) ](https://jameskilby.co.uk/2024/07/new-nodes/)\n\n[Homelab](https://jameskilby.co.uk/category/homelab/) | [Nutanix](https://jameskilby.co.uk/category/nutanix/) | [VMware](https://jameskilby.co.uk/category/vmware/)\n\n### [New Nodes](https://jameskilby.co.uk/2024/07/new-nodes/)\n\nBy[James](https://jameskilby.co.uk) July 2, 2024January 18, 2026\n\nI recently decided to update some of my homelab hosts and I managed to do this at very little cost by offloading 2 of my Supermicro e200‚Äôs to fellow vExpert Paul. The below post describes what I bought why and how I have configured it. Table of Contents Node Choice Bill of Materials Rescue IPMI‚Ä¶",
  "excerpt": "![](https://jameskilby.co.uk/wp-content/uploads/2024/12/ZFS.jpg)\n\n[TrueNAS Scale](https://jameskilby.co.uk/category/truenas-scale/) | [VMware](https://jameskilby.co.uk/category/vmware/) | [vSAN](https://jameskilby.co.uk/category/vmware/vsan-vmware/) | [vSphere](https://jameskilby.co.uk/category/vsph..."
}