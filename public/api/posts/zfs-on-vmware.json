{
  "slug": "zfs-on-vmware",
  "title": "How to Run ZFS on VMware vSphere: Setup Guide and Best Practices",
  "description": "ZFS,VMware,Best Practices for seamless integration and performance. Learn how to optimize your setup for maximum efficiency and reliability.",
  "date": "2024-12-18T17:47:57Z",
  "modified": "2026-01-18T21:36:48Z",
  "author": "James Kilby",
  "url": "https://jameskilby.co.uk/2024/12/zfs-on-vmware/",
  "markdown_url": "/markdown/posts/zfs-on-vmware.md",
  "api_url": "/api/posts/zfs-on-vmware.json",
  "categories": [
    "TrueNAS Scale",
    "VMware",
    "vSAN",
    "vSphere",
    "VMware Cloud on AWS",
    "VCF",
    "Homelab",
    "Storage",
    "vExpert",
    "Synology",
    "Artificial Intelligence",
    "Docker",
    "Hosting"
  ],
  "tags": [
    null,
    null,
    null,
    null,
    null
  ],
  "image": "https://jameskilby.co.uk/wp-content/uploads/2024/12/IMG_20140330_210511-1024x845.jpeg",
  "content": "![](https://jameskilby.co.uk/wp-content/uploads/2024/12/ZFS.jpg)\n\n[TrueNAS Scale](https://jameskilby.co.uk/category/truenas-scale/) | [VMware](https://jameskilby.co.uk/category/vmware/) | [vSAN](https://jameskilby.co.uk/category/vmware/vsan-vmware/) | [vSphere](https://jameskilby.co.uk/category/vsphere/)\n\n# How to Run ZFS on VMware vSphere: Setup Guide and Best Practices\n\nBy[James](https://jameskilby.co.uk) December 18, 2024January 18, 2026 ‚Ä¢ üìñ3 min read(600 words)\n\nüìÖ **Published:** December 18, 2024‚Ä¢ **Updated:** January 18, 2026\n\n## Table of Contents\n\n## \n\nI have run a number of systems using ZFS since the earliest days of my homelab using Nexenta, all the way back in 2010. The image below command is my lab at the time with an IBM head unit that I think had 18GB of RAM 6x450GB SAS drives and this was then connected to the Dell PowerVault SCSI Array above it with 14x146GB 10K SAS drives‚Ä¶.\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/IMG_20140330_210511-1024x845.jpeg)Original Nexenta Setup\n\nThe number one rule is to ALWAYS give ZFS access to the underlying raw storage. You don‚Äôt want a raid controller or anything else interfering with the IO path. This is similar to how vSAN works with VMware.\n\nBut rules are meant to be broken right‚Ä¶.. I have virtualized a few copies of TrueNAS Scale and Core which uses ZFS on top of VMware and in these particular instances I specifically DON‚ÄôT want to pass through the storage in the of an HBA or drives of an HBA or drives. Why would I do this? Mainly of two reasons. This allows me to test upgrades of my physical TrueNAS setup with an easy rollback if needed by not passing the drives or controllers in I can clone and snapshot the VMss just as if it was any other and move it around my lab infrastructure.\n\n## Copy on Write\n\nZFS is a ‚ÄúCopy on Write‚Äù file system which means that it never overwrites existing blocks of storage. It always places writes into new blocks. This is unfriendly with ‚Äúthin provisioning‚Äù something I am a huge fan of. This means that over time even a tiny database writing one megabyte file over and over again will slowly clog the entire file system.\n\nSo if you‚Äôre going to break the rules. The way I see it is you might as well do it properly\n\nThe first requirement is that the VM‚Äôs be provisioned with thin disks in vSphere. If is not thin then unmap won‚Äôt work. This is important in case you are thin at the underlay storage level.\n\n## Disk IDs\n\nYou also need to do is to to ensure that TrueNAS can see unique disk IDs. To do this shut down the VM‚Äôs and add the following parameter to the VMware VM‚Äôs configuration\n    \n    \n     disk.EnableUUID=TRUE\n\nüìã Copy\n\nOnce this is done when you power the VM‚Äôs on you should be able to see unique serials of each disk similar to this screenshot Prior to this change, the serial section is blank.\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/Disk-Serials-1024x125.png)\n\n## Trim\n\nOnce the disks are seen as unique it is possible to enable To confirm that trim is working execute the below command command. ( I have no idea why this is a blocker but it is)\n\nYou can enable auto To confirm that trim is working execute the below command command in the Storage Dashboard under ‚ÄúZFS Health‚Äù\n\nI decided to manually enable it by executing the below command command in the shell. ( my Pool is called Pool-1)\n    \n    \n    sudo zpool To confirm that trim is working execute the below command command Pool-1\n\nüìã Copy\n\nTo confirm that To confirm that trim is working execute the below command command is working execute the below command command\n    \n    \n    sudo zpool status Pool-1\n\nüìã Copy\n\nIf everything is working you will see the To confirm that trim is working execute the below command command command as per below command\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/To confirm that trim is working execute the below command command-1-1024x452.png)\n\nA further validation that this is working is to review the VMss storage used, see the before and after of this VMss\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/vm-Before-2.png)\n\nAdditional confirmation can be seen by reviewing the underlying (vSAN consumption in this case). Before and after listed below command\n\n![](https://jameskilby.co.uk/wp-content/uploads/2024/12/vSAN-Before.png) ![](https://jameskilby.co.uk/wp-content/uploads/2024/12/vSAN-After-1.png)\n\n## Similar Posts\n\n  * [ ![VMC Host Errors](https://jameskilby.co.uk/wp-content/uploads/2022/11/iu-1-768x395.png) ](https://jameskilby.co.uk/2020/09/vmc-host-errors/)\n\n[VMware](https://jameskilby.co.uk/category/vmware/) | [VMware Cloud on AWS](https://jameskilby.co.uk/category/vmware/vmware-cloud-on-aws/)\n\n### [VMC Host Errors](https://jameskilby.co.uk/2020/09/vmc-host-errors/)\n\nBy[James](https://jameskilby.co.uk) September 15, 2020October 1, 2025\n\nWhen you run a large enough Infrastructure failure is inevitable. How you handle that can be a big differentiator. With VMware Cloud on AWS, the hosts are monitored 24√ó7 by VMware/AWS Support all as part of the service. If you pay for X number of hosts you should have X. That includes during maintenance and‚Ä¶\n\n  * [ ![MultiHost Holodeck VCF](https://jameskilby.co.uk/wp-content/uploads/2023/12/Holodeck-Overview.png) ](https://jameskilby.co.uk/2024/01/multihost-holodeck-vcf/)\n\n[VMware](https://jameskilby.co.uk/category/vmware/) | [VCF](https://jameskilby.co.uk/category/vmware/vcf/)\n\n### [MultiHost Holodeck VCF](https://jameskilby.co.uk/2024/01/multihost-holodeck-vcf/)\n\nBy[James](https://jameskilby.co.uk) January 17, 2024January 18, 2026\n\nHow to Deploy VMware Holodeck on multiple hosts\n\n  * [ ](https://jameskilby.co.uk/2022/01/lab-update-part-1-compute/)\n\n[Homelab](https://jameskilby.co.uk/category/homelab/) | [VMware](https://jameskilby.co.uk/category/vmware/)\n\n### [Lab Update ‚Äì Compute](https://jameskilby.co.uk/2022/01/lab-update-part-1-compute/)\n\nBy[James](https://jameskilby.co.uk) January 6, 2022July 10, 2024\n\nQuite a few changes have happened in the lab recently. so I decided to do a multipart blog on the changes. The refresh was triggered by the purchase of a SuperMicro Server (2027TR-H71FRF) chassis with 4x X9DRT Nodes / Blades. This is known as a BigTwin configuration in SuperMicro parlance. This is something I was‚Ä¶\n\n  * [ ![Intel Optane NVMe Homelab](https://jameskilby.co.uk/wp-content/uploads/2023/04/intel_optane_ssd_900p_series_aic_-_right_angle_575px.png) ](https://jameskilby.co.uk/2023/04/intel-optane/)\n\n[Homelab](https://jameskilby.co.uk/category/homelab/) | [Storage](https://jameskilby.co.uk/category/storage/) | [vExpert](https://jameskilby.co.uk/category/vexpert/)\n\n### [Intel Optane NVMe Homelab](https://jameskilby.co.uk/2023/04/intel-optane/)\n\nBy[James](https://jameskilby.co.uk) April 17, 2023October 1, 2025\n\nI have been a VMware vExpert for many years and it has brought me many many benefits over the years. I don‚Äôt think it‚Äôs an understatement to say I probably wouldn‚Äôt have my current role within VMware without it. One of the best benefits has been access to a huge amount of licences for VMware‚Ä¶\n\n  * [Homelab](https://jameskilby.co.uk/category/homelab/) | [Storage](https://jameskilby.co.uk/category/storage/) | [Synology](https://jameskilby.co.uk/category/synology/)\n\n### [Lab Storage](https://jameskilby.co.uk/2018/01/lab-storage/)\n\nBy[James](https://jameskilby.co.uk) January 6, 2018July 10, 2024\n\nI have been meaning to post around some of the lab setup for a while. Although it changes frequently at present it‚Äôs as below. I will add some pics when I have tidied up the lab/cables My primary lab storage is all contained within an HP Gen8 Microserver. Currently Configured: 1x INTEL Core i3-4130 running at‚Ä¶\n\n  * [ ![How I Migrated from Pocket to Hoarder with AI Integration](https://jameskilby.co.uk/wp-content/uploads/2025/01/Screenshot-2025-01-29-at-23.30.47-768x411.png) ](https://jameskilby.co.uk/2025/01/how-i-migrated-from-pocket-to-hoarder-and-introduced-some-ai-along-the-way/)\n\n[Artificial Intelligence](https://jameskilby.co.uk/category/artificial-intelligence/) | [Docker](https://jameskilby.co.uk/category/docker/) | [Hosting](https://jameskilby.co.uk/category/hosting/)\n\n### [How I Migrated from Pocket to Hoarder with AI Integration](https://jameskilby.co.uk/2025/01/how-i-migrated-from-pocket-to-hoarder-and-introduced-some-ai-along-the-way/)\n\nBy[James](https://jameskilby.co.uk) January 29, 2025January 18, 2026\n\nUpdate: Hoarder has now been renamed to Karakeep due to a trademark issue I‚Äôve been on a mission recently to regain control of my data. I haven‚Äôt yet faced the humongous task of moving my main email from Gmail, but I have had some successes with other cloud services and a win is a win‚Ä¶‚Ä¶.",
  "excerpt": "![](https://jameskilby.co.uk/wp-content/uploads/2024/12/ZFS.jpg)\n\n[TrueNAS Scale](https://jameskilby.co.uk/category/truenas-scale/) | [VMware](https://jameskilby.co.uk/category/vmware/) | [vSAN](https://jameskilby.co.uk/category/vmware/vsan-vmware/) | [vSphere](https://jameskilby.co.uk/category/vsph..."
}